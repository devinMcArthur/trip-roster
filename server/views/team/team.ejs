<% include ../partial/head %>

<script src="/js/team.js"></script>
<script src="/js/lib/mustache.js"></script>

<h1 class="ui header"><%= team.name %></h1>
<p><%= team.age %> <%= team.league %></p>

<div class="ui segment">
  <div class="ui grid">
    <div class="fourteen wide column">
      <h5 class="header">Manager(s)</h5>
    </div>
    <div class="two wide column">
      <a href="" onclick="loadManagerForm('<%= team.managers %>'); return false;" id="edit-button-holder" style="float: right;"><i id="edit-button" class="edit icon black"></i></a>
    </div>
  </div>
  <div id="manager-form-div"></div>
  <div class="ui celled list">
    <% team.managers.forEach((manager) => { %>
      <div class="item" style="padding: 1em;">
        <a href="/user/<%= userArray[manager]._id %>"><%= userArray[manager].name %></a>
      </div>
    <% }); %>
  </div>
</div>

<div class="ui segment">
  <div class="ui grid">
    <div class="fourteen wide column">
      <h5 class="header">Team Members</h5>
    </div>
    <div class="two wide column">
      <a href="" onclick="loadMemberForm(); return false;" id="member-button-holder" style="float: right;"><i id="member-button" class="id card outline icon black"></i></a>
    </div>
  </div>
  <div id="member-form-div"></div>
  <div class="ui list">
    <% if (typeof memberArray != 'undefined') { %>
      <% team.members.forEach((member) => { %>
        <% if (memberArray[member].player == true) { %>
          <div class="ui segment">
            <a href="" id="member-<%= member %>-edit-button-holder" onclick="loadMemberEditForm('<%= member %>', '<%= memberArray[member].relationships %>'); return false;" style="float:right;"><i id="member-<%= member %>-edit-button" class="edit black icon floated right"></i></a>
            <%= memberArray[member].name %>
            <% var id = member; var name = memberArray[member].name; var phoneNumber = memberArray[member].phoneNumber; var emergencyName = memberArray[member].emergencyName; var emergencyPhone = memberArray[member].emergencyPhone; var player = memberArray[member].player; var array = memberArray %>
            <% include ../partial/memberEditForm %>
            <div class="ui celled list">
              <% memberArray[member].relationships.forEach((rel) => { %>
                <div class="item" style="padding: 1em;">
                  <a href="" id="member-<%= rel %>-edit-button-holder" onclick="loadMemberEditForm('<%= rel %>', '<%= memberArray[rel].relationships %>');return false;" style="float:right;"><i id="member-<%= rel %>-edit-button" class="edit black icon floated right"></i></a>
                  <%= memberArray[rel].name %>
                  <% var id = rel; var name = memberArray[rel].name; var phoneNumber = memberArray[rel].phoneNumber; var emergencyName = memberArray[rel].emergencyName; var emergencyPhone = memberArray[rel].emergencyPhone; var player = memberArray[rel].player; var array = memberArray %>
                  <% include ../partial/memberEditForm %>
                </div>
              <% }); %>
            </div>
          </div>
        <% } %>
        <% if (memberArray[member].relationships == '' && memberArray[member].player == false) { %>
          <div class="ui segment">
            <a href="" id="member-<%= member %>-edit-button-holder" onclick="loadMemberEditForm('<%= member %>', '<%= memberArray[member].relationships %>');return false;" style="float:right;"><i id="member-<%= member %>-edit-button" class="edit black icon floated right"></i></a>
            <%= memberArray[member].name %>
            <% var id = member; var name = memberArray[member].name; var phoneNumber = memberArray[member].phoneNumber; var emergencyName = memberArray[member].emergencyName; var emergencyPhone = memberArray[member].emergencyPhone; var player = memberArray[member].player; var array = memberArray %>
            <% include ../partial/memberEditForm %>
          </div>
        <% } %>
      <% }); %>
    <% } %>
  </div>
</div>

<% include ../partial/foot %>

<script id="manager-form-template" type="text/template">
  <div class="ui center aligned middle aligned grid segment" id="manager-form" style="margin:0;">
    <div class="column">
      <a class="black" href="" onclick="closeManagerForm()"><i class="icon delete black" style="float: right; margin: none;" ></i></a>
      <h2 class="ui header" data-tooltip="ha" style="color: green;">Manage Managers</h2>
      <form class="ui large form" action="/team/<%= team._id %>/update" method="post">
        <div class="ui stacked segment">
          <label style="float: left;"><b>Manager(s)</b></label>
          <div class="field">
            <div class="ui fluid multiple search selection dropdown">
              <input type="hidden" name="managers">
              <i class="dropdown icon"></i>
              <div class="default text">Select Managers</div>
              <div class="menu">
                <% if (typeof userArray != 'undefined') { %>
                  <% for (var i in userArray) { %>
                    <div class="item" data-value="<%= i %>"><%= userArray[i].name %></div>
                  <% } %>
                <% } else { %>
                  <div class="item" data-value="">We were unable to retreive any users, please try again</div>
                <% } %>
              </div>
            </div>
          </div>
          <div id="submit-button" class="ui fluid black submit button" style="background-color: green;">Create</div>
        </div>
      </form>
    </div>
  </div>
</script>

<script id="manager-edit-button-template" type="text/template">
  <i id="edit-button" class="edit icon black"></i>
</script>

<script id="member-form-template" type="text/template">
  <div class="ui center aligned middle aligned grid segment" style="margin: 0;" id="member-form">
    <div class="column">
      <a class="black" href="" onclick="closeMemberForm()"><i class="icon delete black" style="float: right; margin: none;" ></i></a>
      <h2 class="ui header" style="color: green;" >
        <div class="content">
          Add a Team Member
        </div>
      </h2>
      <form class="ui large form" action="/member" method="post" >
        <div class="ui stacked segment">
          <label style="float: left;"><b>Name</b></label>
          <div class="field">
            <div class="ui left icon input">
              <i class="user icon"></i>
              <input id="name-form" type="text" name="name" placeholder="Full Name">
            </div>
          </div>
          <div class="field">
            <label style="float: left;">Phone Number</label>
            <div class="ui left icon input">
              <i class="phone icon"></i>
              <input id="email-form" type="tel" name="phoneNumber" placeholder="Phone Number">
            </div>
          </div>
          <label style="float: left;"><b>Emergency Contact</b></label>
          <div class="field">
            <div class="two fields">
              <div class="field">
                <div class="ui left icon input">
                  <i class="user md icon"></i>
                  <input id="emergency-name-form" type="text" name="emergencyName" placeholder="Full Name">
                </div>
              </div>
              <div class="field">
                <div class="ui left icon input">
                  <i class="phone square icon"></i>
                  <input id="emergency-phone-form" type="tel" name="emergencyPhone" placeholder="Phone Number">
                </div>
              </div>
            </div>
          </div>
          <div class="ui field">
            <div class="ui checkbox" id="player-toggle">
              <label>Player?</label>
              <input class="checkbox" id="player-toggle" type="checkbox" name="player" />
            </div>
          </div>
          <div class="field" id="relationship-form">
            <div class="ui fluid multiple search selection dropdown">
              <input type="hidden" name="relationships">
              <i class="dropdown icon"></i>
              <div class="default text">Choose relationships</div>
              <div class="menu">
                <% if (typeof memberArray != 'undefined') { %>
                  <% for (var i in memberArray) { %>
                    <div class="item" data-value="<%= i %>"><%= memberArray[i].name %></div>
                  <% } %>
                <% } %>
              </div>
            </div>
          </div>
          <div id="relationship-form-div"></div>
          <input type="hidden" name="teams" value="<%= team._id %>">
          <div id="submit-button" class="ui fluid black large submit button" style="background-color: green;">Create</div>
        </div>
      </form>
    </div>
  </div>
</script>

<script id="member-button-template" type="text/template">
  <i id="member-button" class="id card outline icon black"></i>
</script>

<script id="member-edit-button" type="text/template">
  <i id="member-{{id}}-edit-button" class="edit black icon floated right"></i>
</script>